# Jobzee Deployment Guide - Render

This guide walks you through deploying both the frontend and backend of Jobzee to Render.

## Prerequisites

1. **Render Account**: Sign up at [render.com](https://render.com)
2. **MongoDB Atlas**: Set up a MongoDB cluster at [mongodb.com/cloud/atlas](https://www.mongodb.com/cloud/atlas)
3. **Cloudinary Account**: Sign up at [cloudinary.com](https://cloudinary.com) for image uploads
4. **Git Repository**: Push your code to GitHub, GitLab, or Bitbucket

## Step 1: Prepare Your Code

### 1.1 Update Frontend API Calls (Optional)

The project now has an `src/config/api.js` file that automatically uses `REACT_APP_API_URL` from environment variables. However, if you have hardcoded `http://localhost:5000` in your components, you should replace them with:

```javascript
import API_BASE_URL from '../config/api';

// Then use it like:
const response = await fetch(`${API_BASE_URL}/api/endpoint`);
```

### 1.2 Commit and Push Your Changes

```bash
git add .
git commit -m "Configure for Render deployment"
git push origin main
```

## Step 2: Set Up MongoDB Atlas

1. Go to [MongoDB Atlas](https://www.mongodb.com/cloud/atlas)
2. Create a new cluster (free tier is fine)
3. Go to Database Access → Add New Database User
4. Create a user with read/write permissions
5. Go to Network Access → Add IP Address → Allow Access from Anywhere (0.0.0.0/0)
6. Click "Connect" on your cluster → "Connect your application"
7. Copy your connection string (it looks like: `mongodb+srv://username:<password>@cluster.mongodb.net/jobzee`)
8. Replace `<password>` with your actual database password

## Step 3: Deploy to Render Using render.yaml

### Option A: Deploy via Dashboard (Recommended for first-time)

1. **Go to Render Dashboard**: https://dashboard.render.com
2. Click **"New +"** → **"Blueprint"**
3. Connect your Git repository
4. Render will automatically detect the `render.yaml` file
5. Click **"Apply"** to create both services

### Option B: Deploy via render.yaml File

The `render.yaml` file in the root directory automatically configures both services. When you connect your repository, Render will detect it.

## Step 4: Configure Environment Variables

After deployment starts, you need to configure the environment variables:

### Backend Environment Variables

Go to your backend service → **Environment** → Add these variables:

```env
# Database
MONGODB_URI=mongodb+srv://username:password@cluster.mongodb.net/jobzee

# JWT Secret (will be auto-generated by Render, or set your own)
JWT_SECRET=your-super-secret-jwt-key-at-least-64-characters-long

# Cloudinary (for file uploads)
CLOUDINARY_CLOUD_NAME=your-cloudinary-cloud-name
CLOUDINARY_API_KEY=your-cloudinary-api-key
CLOUDINARY_API_SECRET=your-cloudinary-api-secret

# Email Configuration (for password resets)
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USER=your-email@gmail.com
SMTP_PASS=your-app-password
FROM_EMAIL=noreply@yoursite.com

# Google OAuth (optional)
GOOGLE_CLIENT_ID=your-google-client-id

# Frontend URL will be auto-configured from the frontend service
```

### Frontend Environment Variables

Go to your frontend service → **Environment** → Add these variables:

```env
# The backend API URL will be auto-configured from the backend service
# REACT_APP_API_URL will be set automatically

# Google OAuth
REACT_APP_GOOGLE_CLIENT_ID=your-google-client-id

# Mapbox Token (if you use maps)
REACT_APP_MAPBOX_TOKEN=your-mapbox-token
```

## Step 5: Manual Deployment (Alternative)

If you prefer to deploy manually without render.yaml:

### 5.1 Deploy Backend

1. Go to Render Dashboard → **New +** → **Web Service**
2. Connect your repository
3. Configure:
   - **Name**: `jobzee-backend`
   - **Region**: Oregon (or closest to you)
   - **Branch**: `main`
   - **Root Directory**: `jobzee-backend`
   - **Runtime**: Node
   - **Build Command**: `npm install`
   - **Start Command**: `npm start`
   - **Plan**: Free
4. Add all environment variables from Step 4
5. Click **Create Web Service**

### 5.2 Deploy Frontend

1. Go to Render Dashboard → **New +** → **Static Site**
2. Connect your repository
3. Configure:
   - **Name**: `jobzee-frontend`
   - **Region**: Oregon (or closest to you)
   - **Branch**: `main`
   - **Root Directory**: `jobzee-frontend`
   - **Build Command**: `npm install && npm run build`
   - **Publish Directory**: `build`
4. Add environment variables:
   - `REACT_APP_API_URL`: Your backend URL (e.g., `https://jobzee-backend.onrender.com`)
   - `REACT_APP_GOOGLE_CLIENT_ID`: Your Google Client ID
   - `REACT_APP_MAPBOX_TOKEN`: Your Mapbox token
5. Click **Create Static Site**

## Step 6: Update CORS and OAuth Settings

### 6.1 Update Google OAuth

1. Go to [Google Cloud Console](https://console.cloud.google.com)
2. Navigate to your OAuth 2.0 Client ID
3. Add your Render URLs to **Authorized JavaScript origins**:
   - `https://your-frontend-name.onrender.com`
4. Add to **Authorized redirect URIs**:
   - `https://your-frontend-name.onrender.com`

### 6.2 Verify CORS Configuration

The backend CORS is already configured to accept `.onrender.com` domains and the `FRONTEND_URL` environment variable. This was updated in `jobzee-backend/index.js`.

## Step 7: Initialize Admin Account (Optional)

Once your backend is deployed, you can initialize an admin account:

1. SSH into your Render backend service or use the Shell tab
2. Run: `npm run init-admin`
3. Follow the prompts to create an admin user

Or use the admin init key you set in environment variables.

## Step 8: Verify Deployment

1. **Check Backend Health**:
   - Visit: `https://your-backend-name.onrender.com/api/health`
   - You should see a JSON response with status: OK

2. **Check Frontend**:
   - Visit: `https://your-frontend-name.onrender.com`
   - The site should load properly

3. **Test API Connection**:
   - Try logging in or registering a user
   - Check browser console for any CORS errors

## Troubleshooting

### Backend won't start
- Check the logs in Render Dashboard
- Verify all environment variables are set correctly
- Ensure MongoDB connection string is correct

### Frontend can't connect to backend
- Check that `REACT_APP_API_URL` is set to your backend URL
- Verify CORS settings in backend
- Check browser console for errors

### Database connection errors
- Verify MongoDB Atlas is allowing connections from anywhere (0.0.0.0/0)
- Check that the connection string includes the correct password
- Ensure database user has read/write permissions

### Build failures
- Check the build logs in Render Dashboard
- Ensure all dependencies are in package.json
- Try building locally first: `npm run build`

### Free tier limitations
- Render free tier spins down after 15 minutes of inactivity
- First request after spin-down may take 30-60 seconds
- Consider upgrading to a paid plan for production use

## Important Notes

1. **Environment Variables**: Never commit `.env` files to Git. Use Render's environment variable settings.

2. **Database**: MongoDB Atlas free tier has a 512MB storage limit. Monitor your usage.

3. **CORS**: The backend is configured to accept requests from `.onrender.com` domains and the `FRONTEND_URL` environment variable.

4. **Cold Starts**: Free tier services sleep after 15 minutes of inactivity. First request will be slow.

5. **Custom Domains**: You can add custom domains in Render Dashboard under your service settings.

## Updating Your Deployment

Render automatically deploys when you push to your connected branch:

```bash
git add .
git commit -m "Your changes"
git push origin main
```

Render will automatically rebuild and deploy both services.

## Support

- **Render Documentation**: https://render.com/docs
- **MongoDB Atlas**: https://docs.atlas.mongodb.com
- **Cloudinary**: https://cloudinary.com/documentation

## Cost Optimization

- **Free Tier**: Both services can run on Render's free tier
- **MongoDB Atlas**: Free tier (512MB storage)
- **Cloudinary**: Free tier (25 credits/month)

For production, consider upgrading to paid tiers for better performance and uptime.
